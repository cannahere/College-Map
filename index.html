<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="google-site-verification" content="XLI_3QT03lSkcCEmteQWtQeDviYsA07lmIbGu_5GKCc" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Branding and Icons -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="manifest" href="site.webmanifest">

  <!-- SEO Meta Tags -->
  <title>U.S. College Map | Explore Colleges by Location, Type, and State</title>
  <link rel="canonical" href="https://uscollegemap.org/">
  <meta name="description" content="Explore every U.S. college on an interactive map — filter by state, region, or school type to plan your next campus visit. A simple, free tool for students and parents researching universities nationwide.">
  <meta name="keywords" content="college map, university map, US colleges, college finder, college search, college visit planning, college by location, interactive map, higher education USA, find colleges near me">
  <meta name="author" content="U.S. College Map">

  <!-- Open Graph (Social Media Preview) -->
  <meta property="og:title" content="U.S. College Map | Explore Colleges by Location and Type">
  <meta property="og:description" content="Use the U.S. College Map to explore accredited colleges by state, region, or type — a simple way to plan your next campus visit.">
  <meta property="og:image" content="https://uscollegemap.org/USCollegeMap_Logo.png">
  <meta property="og:url" content="https://uscollegemap.org/">
  <meta property="og:type" content="website">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="U.S. College Map — Explore and Plan College Visits">
  <meta name="twitter:description" content="Interactive map of U.S. colleges. Filter by region, state, or school type to find and plan your next college visit.">
  <meta name="twitter:image" content="https://uscollegemap.org/USCollegeMap_Logo.png">

  <!-- Schema Markup (Structured Data) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "U.S. College Map",
    "url": "https://uscollegemap.org/",
    "description": "Interactive map of U.S. colleges and universities by state, region, and school type. Filter and explore campus locations easily.",
    "applicationCategory": "Education",
    "operatingSystem": "All",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "creator": {
      "@type": "Organization",
      "name": "U.S. College Map"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "150"
    },
    "featureList": [
      "Interactive map of all U.S. colleges",
      "Filter by state, region, or school type",
      "Search by college name",
      "Find colleges near your location",
      "Plan college visits efficiently"
    ]
  }
  </script>
  
  <!-- BreadcrumbList Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://uscollegemap.org/"
    }]
  }
  </script>

  <!-- Resource Hints for Performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://unpkg.com">
  <link rel="dns-prefetch" href="https://nominatim.openstreetmap.org">
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {margin:0;font-family:Inter,system-ui,sans-serif;background:#fff;color:#0f172a}
    .main-container {display:flex;flex-direction:column;min-height:100vh}
    .container {max-width:1100px;margin:0 auto;padding:16px}
    header.app-header {position:sticky;top:0;background:#fff;z-index:10;border-bottom:1px solid #e2e8f0;box-shadow:0 10px 25px rgba(15,23,42,.08)}
    .app-header {display:flex;align-items:flex-start;justify-content:flex-start;padding:16px 40px;background:#fff;border-bottom:1px solid #e5e7eb;box-shadow:0 4px 10px rgba(0,0,0,0.05)}
    .header-logo-tagline {display:flex;flex-direction:column;align-items:flex-start;gap:0}
    .site-logo {height:70px;transition:all 0.3s ease;margin-bottom:0}
    .tagline {font-family:Inter,sans-serif;font-size:14px;color:#6b7280;line-height:1.5;text-align:left;margin:0;margin-top:4px;margin-bottom:3px;margin-left:10px;font-weight:400;max-width:calc(100% - 10px)}
    .sr-only {position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}
    @media (max-width:700px){
      .app-header{flex-direction:column;align-items:center;text-align:center;padding:12px 16px;}
      .header-logo-tagline{align-items:center;text-align:center}
      .tagline{text-align:center;margin-left:0;max-width:100%}
      .site-logo{height:56px;margin-bottom:6px;}
      .container{padding:8px;}
      .controls{padding:12px 8px;}
      .row-filters{flex-direction:row;gap:6px;flex-wrap:nowrap;}
      .row-filters .pill{flex:1 1 calc(33.333% - 4px);min-width:0;}
      .row-filters .pill label{display:none}
      .row-filters .pill select{width:100%;font-size:12px;padding:6px 8px;}
      .row-search .pill{flex:1 1 100%;}
      .row-search .pill label{min-width:70px;margin-bottom:0;width:auto;font-size:12px;font-weight:600;color:#475569;}
      .row-search .pill input{flex:1;width:auto;}
      .row-address .pill{flex:1 1 100%;}
      .row-address .pill label{min-width:70px;margin-bottom:0;width:auto;font-size:12px;font-weight:600;color:#475569;}
      .row-address .pill input{flex:1;min-width:120px;}
      .row-address .pill button{flex:0 0 auto;padding:8px 16px;margin-left:4px;}
      .row-radius .pill{flex:1 1 100%;flex-direction:row;align-items:center;flex-wrap:wrap;}
      .row-radius .pill label{min-width:auto;margin-bottom:0;width:auto;margin-right:8px;}
      .row-radius #radius{width:80px;flex:0 0 auto;max-width:80px;}
      .row-radius #units{width:60px;flex:0 0 auto;max-width:60px;}
      .row-radius #clearRadius{width:auto;flex:0 0 auto;padding:8px 12px;margin-left:8px;}
      .pill{flex-direction:row;align-items:center;padding:8px;}
      .pill label{min-width:60px;margin-bottom:0;width:auto;font-size:11px;}
      .pill input,.pill select,.pill button{width:auto;flex:1;}
      .legend{position:relative;bottom:auto;left:auto;margin:8px;width:calc(100% - 16px);text-align:center;}
    }
    .controls {display:flex;flex-direction:column;gap:12px;padding:14px 16px 16px;border-top:1px solid #e5e7eb;background:#fff}
    .row {display:flex;gap:12px;justify-content:space-between}
    .row>.pill {flex:1}
    .pill {display:flex;align-items:center;gap:8px;background:#f1f5f9;border:1px solid #e2e8f0;padding:6px 10px;border-radius:12px;font-size:12px}
    .pill label {color:#475569;font-weight:600;font-size:12px;min-width:60px}
    .pill input,.pill select,.pill button {border:1px solid #e2e8f0;border-radius:10px;padding:8px 10px;background:#fff;color:#0f172a;font-size:14px;flex:1;transition:border-color 0.2s,box-shadow 0.2s}
    .pill input:focus {outline:none;border-color:#4285f4;box-shadow:0 0 0 1px #4285f4}
    .pill button {background:#2563eb;color:#fff;border:none;font-weight:600;cursor:pointer;flex:0}
    #map {height:calc(100vh - 280px);background:#e5e7eb;border-top:1px solid #e2e8f0;position:relative;z-index:1;min-height:500px}
    .legend {position:absolute;bottom:14px;left:14px;background:#fff;padding:8px 10px;border-radius:12px;border:1px solid #e2e8f0;font-size:12px;box-shadow:0 10px 25px rgba(15,23,42,.08);color:#0f172a}
    .leaflet-tooltip {background:#fff;color:#0f172a;border:1px solid #e2e8f0;border-radius:6px;font-size:12px;font-weight:500;padding:4px 8px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    .loading {display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:20px;border-radius:12px;box-shadow:0 10px 25px rgba(15,23,42,.15);z-index:1000}
    .loading.active {display:block}
    .error {display:none;background:#fee;color:#c33;padding:12px;border-radius:8px;margin:12px;border:1px solid #fcc}
    .error.active {display:block}
    .site-footer {background:#fff;border-top:1px solid #e2e8f0;padding:10px 16px;font-size:12px;color:#94A3B8;text-align:center}
    .feedback-button {position:fixed;bottom:18px;right:18px;background:#2563eb;color:#fff;border:none;padding:10px 16px;border-radius:8px;font-family:Inter,sans-serif;font-size:14px;font-weight:500;cursor:pointer;box-shadow:0 4px 12px rgba(37,99,235,0.3);z-index:1000;transition:all 0.2s ease}
    .feedback-button:hover {background:#1d4ed8;box-shadow:0 6px 16px rgba(37,99,235,0.4);transform:translateY(-2px)}
    .feedback-button.hidden {display:none}
    .feedback-popup {position:fixed;bottom:70px;right:18px;width:280px;background:#fff;border-radius:12px;box-shadow:0 10px 25px rgba(15,23,42,.15);border:1px solid #e2e8f0;z-index:1001;padding:20px;display:none;animation:fadeIn 0.2s ease-out}
    .feedback-popup.active {display:block}
    .feedback-popup-header {display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;margin-top:-2px}
    .feedback-popup-close {background:none;border:none;font-size:24px;color:#94a3b8;cursor:pointer;line-height:1;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;transition:color 0.2s}
    .feedback-popup-close:hover {color:#64748b}
    .feedback-popup-message {font-size:14px;color:#0f172a;line-height:1.5;margin-bottom:16px}
    .feedback-popup-button {display:inline-block;background:#2563eb;color:#fff;border:none;padding:10px 28px;border-radius:8px;font-family:Inter,sans-serif;font-size:14px;font-weight:500;cursor:pointer;transition:background 0.2s}
    .feedback-popup-button-wrapper {text-align:center;margin-bottom:12px}
    .feedback-popup-button:hover {background:#1d4ed8}
    .feedback-popup-dismiss {display:block;text-align:center;font-size:12px;color:#94a3b8;text-decoration:none;cursor:pointer;transition:color 0.2s}
    .feedback-popup-dismiss:hover {color:#64748b}
    @media (max-width:700px){
      .feedback-popup {width:calc(100% - 36px);max-width:280px;right:18px;left:auto}
    }
    .radius-circle {stroke:#2563eb;stroke-width:2;stroke-dasharray:5,5;fill:none;opacity:0.5;pointer-events:none}
    .address-autocomplete {position:relative;z-index:1001;isolation:isolate}
    .autocomplete-suggestions {display:none;position:absolute;top:calc(100% + 4px);left:0;right:0;background:#fff;border:none;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1),0 8px 24px rgba(0,0,0,0.12);max-height:400px;overflow-y:auto;overflow-x:hidden;z-index:1001;margin-top:0;pointer-events:auto;transform:translateZ(0);will-change:transform}
    .autocomplete-suggestions.active {display:block;animation:fadeIn 0.15s ease-out}
    @keyframes fadeIn {from{opacity:0;transform:translateY(-4px)} to{opacity:1;transform:translateY(0)}}
    .autocomplete-item {padding:0;cursor:pointer;border-bottom:none;font-size:14px;transition:background-color 0.1s;min-height:48px;display:flex;flex-direction:row;align-items:center;position:relative;width:100%;pointer-events:auto;user-select:none;-webkit-user-select:none}
    .autocomplete-item:not(:last-child)::after {content:'';position:absolute;bottom:0;left:56px;right:0;height:1px;background:#f1f5f9}
    .autocomplete-item:hover,.autocomplete-item.highlighted {background-color:#f8f9fa}
    .autocomplete-item:focus {outline:2px solid #4285f4;outline-offset:-2px;background-color:#f8f9fa}
    .autocomplete-item-icon {width:40px;height:40px;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-left:8px}
    .autocomplete-item-icon svg {width:20px;height:20px;fill:#5f6368;display:block}
    .autocomplete-item.highlighted .autocomplete-item-icon svg,.autocomplete-item:hover .autocomplete-item-icon svg {fill:#4285f4}
    .autocomplete-item-content {flex:1;padding:12px 8px 12px 0;min-width:0;display:flex;flex-direction:column;justify-content:center}
    .autocomplete-item .address-name {font-weight:400;color:#202124;margin-bottom:2px;font-size:15px;line-height:1.3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .autocomplete-item .address-name strong {font-weight:500;color:#202124}
    .autocomplete-item.highlighted .address-name,.autocomplete-item:hover .address-name {color:#1a73e8}
    .autocomplete-item.highlighted .address-name strong,.autocomplete-item:hover .address-name strong {color:#1a73e8;font-weight:500}
    .autocomplete-item .address-details {font-size:13px;color:#5f6368;line-height:1.3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .autocomplete-loading {padding:16px;text-align:center;color:#5f6368;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px}
    .autocomplete-loading::before {content:'';width:16px;height:16px;border:2px solid #e0e0e0;border-top-color:#4285f4;border-radius:50%;animation:spin 0.8s linear infinite}
    @keyframes spin {to{transform:rotate(360deg)}}
    .autocomplete-empty {padding:24px;text-align:center;color:#5f6368;font-size:14px}
    @media (max-width: 700px) {
      .autocomplete-item {min-height:52px}
      .autocomplete-item-icon {width:44px;height:44px;margin-left:12px}
      .autocomplete-item-content {padding:14px 12px 14px 0}
      .address-autocomplete .pill{flex-direction:row;align-items:center;flex-wrap:wrap;}
      .address-autocomplete .pill label{min-width:70px;margin-bottom:0;width:auto;}
      .address-autocomplete .pill input{flex:1;min-width:120px;}
      .address-autocomplete .pill button{flex:0 0 auto;padding:8px 16px;margin-left:4px;}
      /* Radius pill special handling - keep inline layout */
      .row .pill:has(#radius){flex-direction:row;align-items:center;flex-wrap:wrap;}
      .row .pill:has(#radius) label{min-width:auto;margin-bottom:0;width:auto;margin-right:8px;}
      #radius{width:80px;flex:0 0 auto;max-width:80px;}
      #units{width:60px;flex:0 0 auto;max-width:60px;}
      #clearRadius{width:auto;flex:0 0 auto;padding:8px 12px;margin-left:8px;}
    }
    @media (max-width: 480px) {
      .container{padding:4px;}
      .controls{padding:8px 4px;}
      .row{gap:6px;}
      .pill{padding:8px;}
    }
    @media (min-width: 701px) and (max-width: 1024px) {
      .row-filters{flex-direction:row;gap:6px;flex-wrap:nowrap;}
      .row-filters .pill{flex:1 1 calc(33.333% - 4px);min-width:0;}
      .row-filters .pill label{display:none}
      .row-filters .pill select{width:100%;font-size:12px;padding:6px 8px;}
      .row-search .pill{flex:1 1 100%;}
      .row-search .pill label{min-width:70px;margin-bottom:0;width:auto;font-size:12px;font-weight:600;color:#475569;}
      .row-search .pill input{flex:1;width:auto;}
      .row-address .pill{flex:1 1 100%;}
      .row-address .pill label{min-width:70px;margin-bottom:0;width:auto;font-size:12px;font-weight:600;color:#475569;}
      .row-address .pill input{flex:1;min-width:120px;}
      .row-address .pill button{flex:0 0 auto;padding:8px 16px;margin-left:4px;}
      .row-radius .pill{flex:1 1 100%;flex-direction:row;align-items:center;flex-wrap:wrap;}
      .row-radius .pill label{min-width:auto;margin-bottom:0;width:auto;margin-right:8px;}
      .row-radius #radius{width:80px;flex:0 0 auto;max-width:80px;}
      .row-radius #units{width:60px;flex:0 0 auto;max-width:60px;}
      .row-radius #clearRadius{width:auto;flex:0 0 auto;padding:8px 12px;margin-left:8px;}
    }
    .about-map {max-width:1100px;margin:16px auto 24px;font-size:13px;color:#475569;background:#f8fafc;border-radius:12px;padding:10px 16px 14px;border:1px solid #e2e8f0}
    .about-map-title {font-weight:600;color:#0f172a;font-size:15px;margin:0 0 12px 0;text-align:center;padding-bottom:12px;border-bottom:2px solid #fff}
    .info-snippets {display:grid;grid-template-columns:repeat(auto-fit, minmax(260px, 1fr));gap:14px;padding-top:8px}
    .snippet h2 {font-size:14px;font-weight:600;margin-bottom:4px;color:#1e293b}
    .snippet p {font-size:13px;color:#64748b;line-height:1.5}
    @media (max-width:700px) {
      .info-snippets {grid-template-columns:1fr}
    }
  </style>
</head>
<body>
<div class="main-container">
  <header class="app-header">
    <div class="header-logo-tagline">
      <img src="USCollegeMap_Logo.png" alt="U.S. College Map logo" class="site-logo">
      <h1 class="sr-only">U.S. College Map | Explore Colleges by Location, Type, and State</h1>
      <p class="tagline">Planning college visits? Use the U.S. College Map to explore schools by type, state, or location — and find colleges to visit near home or along your next trip.</p>
    </div>
  </header>

  <main>
  <nav class="container controls" aria-label="College search filters">
    <div class="row row-filters">
      <div class="pill"><label for="type">Type</label><select id="type"><option value="">All college types</option></select></div>
      <div class="pill"><label for="region">Region</label><select id="region"><option value="">All regions</option></select></div>
      <div class="pill"><label for="state">State</label><select id="state"><option value="">All states</option></select></div>
    </div>
    <div class="row row-search">
      <div class="pill"><label for="search">Search</label><input id="search" placeholder="Search by college name..." /></div>
    </div>
    <div class="row row-address">
      <div class="pill address-autocomplete"><label for="address">Address</label><input id="address" placeholder="Enter your home address" autocomplete="off" aria-autocomplete="list" aria-expanded="false" aria-controls="addressSuggestions" aria-haspopup="listbox" role="combobox" /><button id="geocodeBtn">Locate</button><div class="autocomplete-suggestions" id="addressSuggestions" role="listbox" aria-label="Address suggestions"></div></div>
    </div>
    <div class="row row-radius">
      <div class="pill"><label for="radius">Radius</label><input id="radius" type="number" min="0" step="10" value="50" style="width:90px"><select id="units"><option value="mi" selected>mi</option><option value="km">km</option></select><button id="clearRadius" style="background:transparent;color:#0f172a;border:1px solid #e2e8f0;">Clear</button></div>
    </div>
  </nav>

  <section id="map" aria-label="Interactive college map"></section>
  <div class="legend" id="legend">Showing <span id="count">0</span> schools</div>
  <div class="loading" id="loading">Loading colleges data...</div>
  <div class="error" id="error"></div>
  
  <section class="about-map">
    <h2 class="about-map-title">About This Map</h2>
    <div class="info-snippets" aria-label="College visit planning resources">
      <div class="snippet">
        <h2>How to plan a college visit using this map</h2>
        <p>Use the U.S. College Map to find schools near where you live or where you plan to travel. Filter by type, region, or state, then narrow by address and radius to build an efficient visit day.</p>
      </div>
      <div class="snippet">
        <h2>Explore colleges by U.S. region</h2>
        <p>Looking at the Northeast, West, or South? The map lets you visualize every school in that area so you can compare locations quickly and discover options you may not have seen in lists.</p>
      </div>
      <div class="snippet">
        <h2>Why a college map helps</h2>
        <p>Seeing schools on a map makes it easier to group visits, spot nearby campuses, and plan future trips. This site is meant for students and families doing early research.</p>
      </div>
    </div>
  </section>
  </main>
</div>
<footer class="site-footer">© 2025 U.S. College Map</footer>

<script>
const localMode = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
const DATA_URL = localMode ? 'colleges_usa_2024.csv' : 'https://uscollegemap.org/colleges_usa_2024.csv';

// Cache DOM references for performance
const elements = {
  state: document.getElementById('state'),
  region: document.getElementById('region'),
  type: document.getElementById('type'),
  search: document.getElementById('search'),
  address: document.getElementById('address'),
  radius: document.getElementById('radius'),
  units: document.getElementById('units'),
  count: document.getElementById('count'),
  loading: document.getElementById('loading'),
  error: document.getElementById('error'),
  geocodeBtn: document.getElementById('geocodeBtn'),
  clearRadius: document.getElementById('clearRadius'),
  addressSuggestions: document.getElementById('addressSuggestions')
};

let addressAutocomplete = {
  suggestions: [],
  selectedIndex: -1,
  isOpen: false,
  abortController: null,
  isSelecting: false
};

const americasBounds = L.latLngBounds([[-60,-180],[85,-30]]);
const map = L.map('map',{maxBounds:americasBounds,maxBoundsViscosity:1}).setView([39.5,-98.35],4);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'&copy; OpenStreetMap contributors',attributionControl:true}).addTo(map);

const markersLayer = L.layerGroup().addTo(map);

const homeLayer = L.layerGroup().addTo(map);
const radiusLayer = L.layerGroup().addTo(map);
let colleges = [], home = null;

const TYPE_ORDER = ["Ivy League","Elite Private Universities","Public Flagship Universities","Private Liberal Arts Colleges","STEM / Technology Institutes","Business / Arts / Specialty Schools","Health & Medical Colleges","Faith-Based","Public Regional Universities","Community Colleges","Online / For-Profit"];

// Region mapping for better performance
const REGION_MAP = {
  'Northeast': ['ME','NH','VT','MA','RI','CT','NY','NJ','PA'],
  'Midwest': ['OH','MI','IN','IL','WI','MN','IA','MO','ND','SD','NE','KS'],
  'South': ['DE','MD','DC','VA','WV','NC','SC','GA','FL','KY','TN','AL','MS','AR','LA','TX','OK'],
  'West': ['MT','ID','WY','CO','NM','AZ','UT','NV','CA','OR','WA','HI','AK'],
  'Territories': ['PR','GU','VI','AS','MP']
};

// Calculate distance between two coordinates (Haversine formula)
function calculateDistance(lat1, lon1, lat2, lon2, unit = 'mi') {
  const R = unit === 'mi' ? 3959 : 6371; // Earth radius in miles or km
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon/2) * Math.sin(dLon/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

// Debounce function for search input
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

function showError(message) {
  elements.error.textContent = message;
  elements.error.classList.add('active');
  setTimeout(() => elements.error.classList.remove('active'), 5000);
}

function render(){
  // Check if colleges data is loaded
  if (!colleges || colleges.length === 0) {
    console.log('No colleges data available yet');
    elements.count.textContent = '0';
    return;
  }
  
  markersLayer.clearLayers();
  radiusLayer.clearLayers();
  
  const stateVal = elements.state.value;
  const regionVal = elements.region.value;
  const typeVal = elements.type.value;
  const searchVal = elements.search.value.toLowerCase().trim();
  const radiusVal = parseFloat(elements.radius.value) || 0;
  const unitsVal = elements.units.value;

  let filtered = colleges.filter(c => {
    // Region filter
    const regionMatch = !regionVal || (REGION_MAP[regionVal] || []).includes(c.state);
    if (!regionMatch) return false;
    
    // State filter
    if (stateVal && c.state !== stateVal) return false;
    
    // Type filter
    if (typeVal && (c.type || c.tier) !== typeVal) return false;
    
    // Search filter
    if (searchVal && !c.name.toLowerCase().includes(searchVal)) return false;
    
    // Radius filter (if home location is set)
    if (home && radiusVal > 0) {
      const distance = calculateDistance(home.lat, home.lon, c.lat, c.lon, unitsVal);
      if (distance > radiusVal) return false;
    }
    
    return true;
  });

  // Draw radius circle if home and radius are set
  if (home && radiusVal > 0) {
    const radiusMeters = radiusVal * (unitsVal === 'mi' ? 1609.34 : 1000);
    L.circle([home.lat, home.lon], {
      radius: radiusMeters,
      color: '#2563eb',
      fillColor: '#2563eb',
      fillOpacity: 0.1,
      weight: 2,
      dashArray: '5, 5'
    }).addTo(radiusLayer);
  }

  console.log(`Rendering ${filtered.length} colleges`);
  
  filtered.forEach(c => {
    try {
      // Validate coordinates
      if (isNaN(c.lat) || isNaN(c.lon) || c.lat === 0 || c.lon === 0) {
        console.warn(`Invalid coordinates for ${c.name}:`, c.lat, c.lon);
        return;
      }
      
      const tuition = c.tuition ? (c.tuition.toString().includes('$') ? c.tuition : `$${Number(c.tuition).toLocaleString()}`) : 'N/A';
      const acceptance = c.acceptance ? (c.acceptance.toString().includes('%') ? c.acceptance : `${parseFloat(c.acceptance).toFixed(1)}%`) : 'N/A';
      
      // Calculate distance if home is set
      let distanceText = '';
      if (home) {
        const distance = calculateDistance(home.lat, home.lon, c.lat, c.lon, unitsVal);
        distanceText = `<br>Distance: ${distance.toFixed(1)} ${unitsVal}`;
      }
      
      const popupContent = `
        <div style="font-size:12px;line-height:1.4">
          <b>${c.name}</b><br>
          ${c.state} · ${(c.type||'Unknown')}${distanceText}<br>
          ${c.control ? c.control + ' | ' : ''}Acceptance Rate: ${acceptance}<br>
          Enrollment: ${c.enrollment || 'N/A'}<br>
          Tuition: ${tuition}<br>
          ${c.url ? `<a href="https://${c.url.replace(/^https?:\/\//,'')}" target="_blank">${c.url}</a>` : ''}
        </div>`;

    L.circleMarker([c.lat, c.lon], {radius: 5, color: '#2563eb', weight: 2, fillOpacity: 0.7})
      .bindTooltip(c.name, {permanent: false, direction: 'top'})
      .bindPopup(popupContent)
      .addTo(markersLayer);
    } catch (e) {
      console.error(`Error creating marker for ${c.name}:`, e);
    }
  });

  elements.count.textContent = filtered.length.toLocaleString();
  console.log(`Added ${filtered.length} markers to map`);
}

function refreshDropdown(id, values, placeholder) {
  const select = document.getElementById(id);
  select.innerHTML = `<option value="">${placeholder}</option>` + values.map(v => `<option>${v}</option>`).join('');
}

function loadCSV(url){
  elements.loading.classList.add('active');
  
  // Try to load from cache first
  const cacheKey = 'colleges_data_cache';
  const cacheTime = 'colleges_data_time';
  const cacheExpiry = 24 * 60 * 60 * 1000; // 24 hours
  
  try {
    const cachedData = localStorage.getItem(cacheKey);
    const cachedTime = localStorage.getItem(cacheTime);
    
    if (cachedData && cachedTime && Date.now() - parseInt(cachedTime) < cacheExpiry) {
      const data = JSON.parse(cachedData);
      processCollegesData(data);
      elements.loading.classList.remove('active');
      return;
    }
  } catch (e) {
    // Cache read failed, proceed with download
  }
  
  Papa.parse(url, {
    header: true,
    dynamicTyping: true,
    download: true,
    complete: (results) => {
      elements.loading.classList.remove('active');
      
      console.log('CSV parsing complete. Rows:', results.data?.length);
      
      if (results.errors && results.errors.length > 0) {
        console.warn('CSV parsing errors:', results.errors);
      }
      
      if (!results.data || results.data.length === 0) {
        showError('Failed to load colleges data. Please refresh the page.');
        console.error('No data in CSV results');
        return;
      }
      
      // Cache the data
      try {
        localStorage.setItem(cacheKey, JSON.stringify(results.data));
        localStorage.setItem(cacheTime, Date.now().toString());
        console.log('Data cached successfully');
      } catch (e) {
        console.warn('Cache write failed:', e);
      }
      
      processCollegesData(results.data);
    },
    error: (error) => {
      elements.loading.classList.remove('active');
      showError('Error loading colleges data: ' + (error.message || 'Unknown error'));
      console.error('CSV load error:', error);
    }
  });
}

function processCollegesData(data) {
  colleges = data.filter(r => r.name && r.lat && r.lon).map(r => ({
    name: r.name,
    lat: +r.lat,
    lon: +r.lon,
    state: (r.state || '').toUpperCase(),
    type: r.type || 'Unknown',
    control: r.control || '',
    acceptance: r.acceptance || '',
    enrollment: r.enrollment || '',
    tuition: r.tuition || '',
    url: r.url || ''
  }));
  
  console.log(`Loaded ${colleges.length} colleges`);
  
  if (colleges.length === 0) {
    showError('No college data found. Please check the CSV file.');
    return;
  }
  
  const states = [...new Set(colleges.map(c => c.state))].sort();
  const types = [...new Set(colleges.map(c => c.type))].filter(Boolean);
  const ranked = [...TYPE_ORDER.filter(t => types.includes(t))];
  const leftovers = types.filter(t => !TYPE_ORDER.includes(t)).sort();
  const orderedTypes = ranked.concat(leftovers);
  
  refreshDropdown('state', states, 'All states');
  refreshDropdown('type', orderedTypes, 'All college types');
  refreshDropdown('region', ['Northeast', 'Midwest', 'South', 'West', 'Territories'], 'All regions');
  
  render();
}

function geocodeAddress(address){
  if(!address) {
    showError('Please enter an address');
    return;
  }
  
  closeAutocomplete();
  elements.loading.classList.add('active');
  
  // Rate limiting: Nominatim requires a User-Agent and has strict rate limits
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1&addressdetails=1`, {
    headers: {
      'User-Agent': 'USCollegeMap/1.0'
    }
  })
    .then(r => {
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return r.json();
    })
    .then(data => {
      elements.loading.classList.remove('active');
      
      if (data && data[0]) {
        const lat = +data[0].lat;
        const lon = +data[0].lon;
        home = { lat, lon };
        homeLayer.clearLayers();
        radiusLayer.clearLayers();
        L.marker([lat, lon], { icon: L.icon({
          iconUrl: 'data:image/svg+xml;base64,' + btoa('<svg xmlns="http://www.w3.org/2000/svg" width="25" height="35" viewBox="0 0 12 18"><path fill="#dc2626" d="M6 0C2.69 0 0 2.69 0 6c0 5 6 12 6 12s6-7 6-12c0-3.31-2.69-6-6-6zm0 8.5c-1.38 0-2.5-1.12-2.5-2.5S4.62 3.5 6 3.5 8.5 4.62 8.5 6 7.38 8.5 6 8.5z"/></svg>'),
          iconSize: [25, 35],
          iconAnchor: [12, 35],
          popupAnchor: [0, -35]
        })})
          .bindPopup("Home location")
          .addTo(homeLayer)
          .openPopup();
        map.setView([lat, lon], 8);
        render(); // Re-render to apply radius filter
      } else {
        showError('Address not found. Please try a different address.');
      }
    })
    .catch(error => {
      elements.loading.classList.remove('active');
      showError('Error geocoding address: ' + (error.message || 'Please try again later'));
      console.error('Geocoding error:', error);
    });
}

// Address autocomplete functions
function searchAddresses(query) {
  if (!query || query.length < 3) {
    closeAutocomplete();
    return;
  }
  
  // Cancel previous request if any
  if (addressAutocomplete.abortController) {
    addressAutocomplete.abortController.abort();
  }
  
  // Show loading state
  addressAutocomplete.suggestions = [];
  addressAutocomplete.selectedIndex = -1;
  elements.addressSuggestions.innerHTML = '<div class="autocomplete-loading">Searching...</div>';
  elements.addressSuggestions.classList.add('active');
  addressAutocomplete.isOpen = true;
  
  // Create new abort controller
  addressAutocomplete.abortController = new AbortController();
  
  // URL encoding prevents XSS and handles special characters
  const sanitizedQuery = query.trim().substring(0, 200); // Limit query length
  
  // Use Cloudflare proxy for Google Places Autocomplete API
  fetch(`https://cold-bread-f865.cannahere2007.workers.dev/?input=${encodeURIComponent(sanitizedQuery)}`, {
    signal: addressAutocomplete.abortController.signal
  })
    .then(r => {
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return r.json();
    })
    .then(data => {
      // Handle empty array or invalid response
      if (!Array.isArray(data) || data.length === 0) {
        addressAutocomplete.suggestions = [];
        renderSuggestions();
        return;
      }
      
      // Google Places API already returns well-ranked results
      // Map the response to our format, keeping up to 5 results
      const results = data.slice(0, 5).map(item => ({
        description: item.description || '',
        place_id: item.place_id || '',
        matchedQuery: query
      }));
      
      addressAutocomplete.suggestions = results;
      renderSuggestions();
    })
    .catch(error => {
      if (error.name === 'AbortError') {
        return; // Request was cancelled, ignore
      }
      console.error('Autocomplete error:', error);
      elements.addressSuggestions.innerHTML = '<div class="autocomplete-empty" style="color:#d93025;">Unable to load suggestions. Please try again.</div>';
    });
}

function formatAddressName(displayName, query = '') {
  // Clean up the display name - remove awkward commas after street numbers
  let cleanedName = displayName.replace(/(\d+),\s+/g, '$1 '); // "25, " becomes "25 "
  
  const parts = cleanedName.split(',').map(p => p.trim()).filter(p => p);
  let primary, secondary;
  
  // Format like Google Maps: primary address on first line, location details on second
  if (parts.length >= 3) {
    // Full address: "Street Address, City, State, Country"
    // Primary: Street Address (first part)
    // Secondary: City, State, Country (remaining parts)
    primary = parts[0];
    secondary = parts.slice(1).join(', ');
  } else if (parts.length === 2) {
    // Two parts: check if first is just a number
    if (/^\d+$/.test(parts[0])) {
      // If "25, Location" -> combine to "25 Location"
      primary = parts.join(' ');
      secondary = '';
    } else {
      // "Street, City" -> Primary: Street, Secondary: City
      primary = parts[0];
      secondary = parts[1];
    }
  } else {
    // Single part
    primary = cleanedName;
    secondary = '';
  }
  
  // Escape HTML first, then apply highlighting
  // This is simpler and safer - we'll find matches in escaped text
  const escapeHtml = (text) => text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  
  // Escape the text first
  let escapedPrimary = escapeHtml(primary);
  secondary = escapeHtml(secondary);
  
  // Now apply highlighting on the escaped text
  if (query && query.length >= 2) {
    const queryLower = query.toLowerCase().trim();
    const escapedQueryLower = escapeHtml(query).toLowerCase();
    const escapedPrimaryLower = escapedPrimary.toLowerCase();
    const matchIndex = escapedPrimaryLower.indexOf(escapedQueryLower);
    
    if (matchIndex !== -1) {
      const before = escapedPrimary.substring(0, matchIndex);
      const match = escapedPrimary.substring(matchIndex, matchIndex + escapeHtml(query).length);
      const after = escapedPrimary.substring(matchIndex + escapeHtml(query).length);
      escapedPrimary = `${before}<strong>${match}</strong>${after}`;
    }
  }
  
  primary = escapedPrimary;
  
  return { primary, secondary };
}

function getAddressTypeIcon(type) {
  // Determine icon based on address type
  const icons = {
    'place': '<path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>',
    'house': '<path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>',
    'default': '<path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>'
  };
  
  const addressType = (type || '').toLowerCase();
  if (addressType.includes('house') || addressType.includes('building') || addressType.includes('residential')) {
    return icons.house;
  }
  if (addressType.includes('place') || addressType.includes('point')) {
    return icons.place;
  }
  return icons.default;
}

function renderSuggestions() {
  if (addressAutocomplete.suggestions.length === 0) {
    elements.addressSuggestions.innerHTML = '<div class="autocomplete-empty" role="option">No suggestions found</div>';
    return;
  }
  
  const html = addressAutocomplete.suggestions.map((item, index) => {
    const isSelected = index === addressAutocomplete.selectedIndex;
    const query = item.matchedQuery || '';
    const formatted = formatAddressName(item.description, query);
    
    // formatAddressName already escapes HTML and handles <strong> tags
    const safePrimary = formatted.primary;
    const safeSecondary = formatted.secondary;
    const safeFullName = item.description.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/&/g, '&amp;');
    
    // Get icon - Google Places API doesn't provide type in autocomplete, use default
    const iconPath = getAddressTypeIcon('place');
    
    return `
      <div class="autocomplete-item ${isSelected ? 'highlighted' : ''}" 
           role="option"
           id="suggestion-${index}"
           aria-selected="${isSelected}"
           tabindex="${isSelected ? '0' : '-1'}"
           data-index="${index}">
        <div class="autocomplete-item-icon">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            ${iconPath}
          </svg>
        </div>
        <div class="autocomplete-item-content">
          <div class="address-name">${safePrimary}</div>
          ${safeSecondary ? `<div class="address-details">${safeSecondary}</div>` : ''}
        </div>
      </div>
    `;
  }).join('');
  
  elements.addressSuggestions.innerHTML = html;
  elements.address.setAttribute('aria-expanded', 'true');
  
  // Add mouseenter handlers for highlighting
  elements.addressSuggestions.querySelectorAll('.autocomplete-item').forEach((item, index) => {
    // Ensure item is properly clickable
    item.style.pointerEvents = 'auto';
    item.style.cursor = 'pointer';
    
    // Add direct click handler - this is the primary method
    const handleClick = (e) => {
      e.stopImmediatePropagation();
      e.preventDefault();
      e.stopPropagation();
      selectSuggestion(index);
      return false;
    };
    
    item.addEventListener('click', handleClick, true);
    item.addEventListener('mousedown', (e) => {
      e.preventDefault(); // Prevent input blur
    });
    
    // Update highlight without re-rendering - just update classes
    item.addEventListener('mouseenter', () => {
      addressAutocomplete.selectedIndex = index;
      updateHighlight();
    });
    
    // Also handle touch events for mobile
    item.addEventListener('touchend', handleClick, { passive: false, capture: true });
  });
}

function selectSuggestion(index) {
  if (!addressAutocomplete.suggestions || !addressAutocomplete.suggestions[index]) {
    console.warn('No suggestion at index:', index, 'Available:', addressAutocomplete.suggestions.length);
    return;
  }
  
  const suggestion = addressAutocomplete.suggestions[index];
  const description = suggestion.description || '';
  
  if (!description) {
    console.warn('No description found for suggestion at index:', index);
    return;
  }
  
  // Mark that we're programmatically setting the value (prevents triggering new search)
  addressAutocomplete.isSelecting = true;
  
  // Close dropdown FIRST - instant visual feedback
  closeAutocomplete();
  
  // Set the input value immediately - user sees it instantly
  elements.address.value = description;
  
  // Clear the flag after a brief delay to allow the value to be set
  setTimeout(() => {
    addressAutocomplete.isSelecting = false;
  }, 100);
  
  // Geocode the address to update the map (this happens asynchronously)
  geocodeAddress(description);
}

function closeAutocomplete() {
  elements.addressSuggestions.classList.remove('active');
  elements.address.setAttribute('aria-expanded', 'false');
  addressAutocomplete.isOpen = false;
  addressAutocomplete.selectedIndex = -1;
}

function updateHighlight() {
  // Update highlight without re-rendering - just update classes
  elements.addressSuggestions.querySelectorAll('.autocomplete-item').forEach((item, index) => {
    if (index === addressAutocomplete.selectedIndex) {
      item.classList.add('highlighted');
      item.setAttribute('aria-selected', 'true');
      item.setAttribute('tabindex', '0');
    } else {
      item.classList.remove('highlighted');
      item.setAttribute('aria-selected', 'false');
      item.setAttribute('tabindex', '-1');
    }
  });
}

function handleAutocompleteKeydown(e) {
  if (!addressAutocomplete.isOpen || addressAutocomplete.suggestions.length === 0) {
    if (e.key === 'Enter') {
      e.preventDefault();
      geocodeAddress(elements.address.value);
    }
    return;
  }
  
  switch(e.key) {
    case 'ArrowDown':
      e.preventDefault();
      addressAutocomplete.selectedIndex = Math.min(
        addressAutocomplete.selectedIndex + 1,
        addressAutocomplete.suggestions.length - 1
      );
      updateHighlight();
      scrollToSelected();
      break;
      
    case 'ArrowUp':
      e.preventDefault();
      addressAutocomplete.selectedIndex = Math.max(addressAutocomplete.selectedIndex - 1, -1);
      updateHighlight();
      scrollToSelected();
      break;
      
    case 'Enter':
      e.preventDefault();
      if (addressAutocomplete.selectedIndex >= 0) {
        selectSuggestion(addressAutocomplete.selectedIndex);
      } else {
        geocodeAddress(elements.address.value);
      }
      break;
      
    case 'Escape':
      e.preventDefault();
      closeAutocomplete();
      break;
  }
}

function scrollToSelected() {
  const selected = elements.addressSuggestions.querySelector('.autocomplete-item.highlighted');
  if (selected) {
    selected.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
  }
}

// Initialize dropdowns immediately
// Region dropdown (doesn't depend on CSV)
refreshDropdown('region', ['Northeast', 'Midwest', 'South', 'West', 'Territories'], 'All regions');

// Type dropdown (initialize with common types, will be updated when CSV loads)
try {
  refreshDropdown('type', TYPE_ORDER.filter(Boolean), 'Any college type');
} catch (e) {
  console.error('Error initializing type dropdown:', e);
  // Fallback: ensure dropdown at least exists
  const typeSelect = document.getElementById('type');
  if (typeSelect) {
    typeSelect.innerHTML = '<option value="">All college types</option>';
  }
}

// Event listeners
elements.geocodeBtn.onclick = () => geocodeAddress(elements.address.value);

// Address autocomplete
elements.address.addEventListener('input', debounce((e) => {
  // Don't trigger search if we're programmatically setting the value
  if (addressAutocomplete.isSelecting) {
    return;
  }
  searchAddresses(e.target.value);
}, 400));

elements.address.addEventListener('keydown', handleAutocompleteKeydown);

// Event delegation as backup (items have direct handlers, but this catches edge cases)
elements.addressSuggestions.addEventListener('click', (e) => {
  const item = e.target.closest('.autocomplete-item');
  if (item) {
    const index = parseInt(item.dataset.index, 10);
    if (!isNaN(index) && index >= 0) {
      e.preventDefault();
      e.stopPropagation();
      selectSuggestion(index);
    }
  }
}, true);

// Close autocomplete when clicking outside
document.addEventListener('click', (e) => {
  // Only close if click is truly outside
  if (!elements.address.contains(e.target) && 
      !elements.addressSuggestions.contains(e.target) &&
      !e.target.closest('.autocomplete-item')) {
    closeAutocomplete();
  }
}, true);

elements.clearRadius.onclick = () => {
  elements.radius.value = '50';
  home = null;
  homeLayer.clearLayers();
  radiusLayer.clearLayers();
  map.setView([39.5, -98.35], 4);
  render();
};

['state', 'region', 'type', 'radius', 'units'].forEach(id => {
  document.getElementById(id).addEventListener('change', render);
});

// Debounced search input
elements.search.addEventListener('input', debounce(render, 300));

// Check if running from file:// protocol (won't work due to CORS)
if (window.location.protocol === 'file:') {
  showError('Please use a web server to test this page. CSV files cannot load from file:// protocol. Use: python3 -m http.server 8000');
  console.error('Cannot load CSV from file:// protocol due to CORS restrictions');
} else {
  loadCSV(DATA_URL);
}
</script>

<!-- Feedback Widget -->
<div class="feedback-button" id="feedbackButton">Feedback</div>
<div class="feedback-popup" id="feedbackPopup">
  <div class="feedback-popup-header">
    <div></div>
    <button class="feedback-popup-close" id="feedbackClose" aria-label="Close">×</button>
  </div>
  <div class="feedback-popup-message">We're improving U.S. College Map. Got 30 seconds to tell us what to fix next?</div>
  <div class="feedback-popup-button-wrapper">
    <a href="https://forms.gle/tGNzJr9THUYKfUPZ8" target="_blank" rel="noopener noreferrer" class="feedback-popup-button" style="text-decoration:none">Open feedback form</a>
  </div>
  <a href="#" class="feedback-popup-dismiss" id="feedbackDismiss">Don't show again</a>
</div>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E2KP0JHTMC"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-E2KP0JHTMC');
</script>

<script>
// Feedback Widget
(function() {
  'use strict';
  
  const feedbackButton = document.getElementById('feedbackButton');
  const feedbackPopup = document.getElementById('feedbackPopup');
  
  // Check if user has dismissed the feedback widget
  if (localStorage.getItem('uscm_feedback_dismissed') === 'true') {
    if (feedbackButton) feedbackButton.style.display = 'none';
    if (feedbackPopup) feedbackPopup.style.display = 'none';
    return; // Don't set up event listeners
  }
  
  const feedbackClose = document.getElementById('feedbackClose');
  const feedbackDismiss = document.getElementById('feedbackDismiss');
  
  // Open popup
  feedbackButton.addEventListener('click', function(e) {
    e.stopPropagation();
    feedbackPopup.classList.add('active');
  });
  
  // Close popup
  feedbackClose.addEventListener('click', function() {
    feedbackPopup.classList.remove('active');
  });
  
  // Dismiss permanently
  feedbackDismiss.addEventListener('click', function(e) {
    e.preventDefault();
    localStorage.setItem('uscm_feedback_dismissed', 'true');
    feedbackButton.classList.add('hidden');
    feedbackPopup.classList.remove('active');
  });
  
  // Close popup when clicking outside
  document.addEventListener('click', function(e) {
    if (feedbackPopup.classList.contains('active') && 
        !feedbackPopup.contains(e.target) && 
        !feedbackButton.contains(e.target)) {
      feedbackPopup.classList.remove('active');
    }
  });
})();
</script>

</body>
</html>
